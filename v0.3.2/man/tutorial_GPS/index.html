<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Plot GPS vectors · GeophysicalModelGenerator.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">GeophysicalModelGenerator.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorials/">Overview</a></li><li><a class="tocitem" href="../tutorial_load3DSeismicData/">3D seismic tomography from ASCII</a></li><li><a class="tocitem" href="../tutorial_loadregular3DSeismicData_netCDF/">3D seismic tomography from netCDF</a></li><li><a class="tocitem" href="../tutorial_MohoTopo/">Visualize Moho topography</a></li><li><a class="tocitem" href="../tutorial_GMT_Topography/">Create GMT-based topography</a></li><li><a class="tocitem" href="../tutorial_Coastlines/">Coastlines</a></li><li><a class="tocitem" href="../tutorial_Screenshot_To_Paraview/">Import screenshots</a></li><li><a class="tocitem" href="../tutorial_loadirregular3DSeismicData/">Interpolate irregular 3D seismic tomography</a></li><li><a class="tocitem" href="../tutorial_GMT_Topography_GeologicalMap/">ETOPO1 Topography and geological maps</a></li><li><a class="tocitem" href="../tutorial_ISC_data/">ISC earthquake data</a></li><li class="is-active"><a class="tocitem" href>Plot GPS vectors</a><ul class="internal"><li><a class="tocitem" href="#Goal"><span>Goal</span></a></li><li><a class="tocitem" href="#Steps"><span>Steps</span></a></li></ul></li></ul></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../datastructures/">Data Structures</a></li><li><a class="tocitem" href="../dataimport/">Data Import</a></li><li><a class="tocitem" href="../paraview_output/">Paraview output</a></li><li><a class="tocitem" href="../tools/">Tools</a></li><li><a class="tocitem" href="../gravity_code/">Gravity code</a></li><li><a class="tocitem" href="../lamem/">LaMEM</a></li></ul></li><li><a class="tocitem" href="../listfunctions/">List of functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Plot GPS vectors</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Plot GPS vectors</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaGeodynamics/GeophysicalModelGenerator.jl/blob/master/docs/src/man/tutorial_GPS.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Plot-GPS-data"><a class="docs-heading-anchor" href="#Plot-GPS-data">Plot GPS data</a><a id="Plot-GPS-data-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-GPS-data" title="Permalink"></a></h1><h2 id="Goal"><a class="docs-heading-anchor" href="#Goal">Goal</a><a id="Goal-1"></a><a class="docs-heading-anchor-permalink" href="#Goal" title="Permalink"></a></h2><p>The aim of this tutorial is to show you how you can download and plot GPS data, which are vector data.  The example is based on a paper by Sanchez et al. (2018) <a href="https://essd.copernicus.org/articles/10/1503/2018/#section7">https://essd.copernicus.org/articles/10/1503/2018/#section7</a></p><h2 id="Steps"><a class="docs-heading-anchor" href="#Steps">Steps</a><a id="Steps-1"></a><a class="docs-heading-anchor-permalink" href="#Steps" title="Permalink"></a></h2><h4 id=".-Download-and-import-GPS-data:"><a class="docs-heading-anchor" href="#.-Download-and-import-GPS-data:">1. Download and import GPS data:</a><a id=".-Download-and-import-GPS-data:-1"></a><a class="docs-heading-anchor-permalink" href="#.-Download-and-import-GPS-data:" title="Permalink"></a></h4><p>The data related to the paper can be downloaded from: https://doi.pangaea.de/10.1594/PANGAEA.886889 There you will find links to several data sets. Some are the data on the actual stations and some are interpolated data on a grid. Here, we will use the gridded data as an example (which interpolates the ), and will therefore download the following data sets:</p><ul><li>ALPS2017<em>DEF</em>HZ	Surface deformation model of the Alpine Region	<a href="https://store.pangaea.de/Publications/Sanchez-etal_2018/ALPS2017_DEF_HZ.GRD">https://store.pangaea.de/Publications/Sanchez-etal<em>2018/ALPS2017</em>DEF_HZ.GRD</a></li><li>ALPS2017<em>DEF</em>VT	Vertical deformation model of the Alpine Region	<a href="https://store.pangaea.de/Publications/Sanchez-etal_2018/ALPS2017_DEF_VT.GRD">https://store.pangaea.de/Publications/Sanchez-etal<em>2018/ALPS2017</em>DEF_VT.GRD</a></li></ul><p>Next, we have a look at the data themselves. We will use the package <code>CSV.jl</code> to load the comma-separated data. Let&#39;s have a look at the file <code>ALPS2017_DEF_VT.GRD</code>. If we open it with a text editor, we see that the data starts at line 18, and has the following format:</p><pre><code class="language-none">Column 1: Longitude [degrees]
Column 2: Latitude [degrees]
Column 3: Velocity in the height direction [m/a]
Column 4: Uncertainty of the height component [m/a]


 4.00    43.00    0.000067   0.000287
 4.30    43.00   -0.001000   0.000616
 4.60    43.00   -0.001067   0.000544</code></pre><p>So we have 4 columns with data values, and the data is separated by spaces. We can load that in julia as:</p><pre><code class="language-julia">julia&gt; using CSV, GeophysicalModelGenerator
julia&gt; data_file =   CSV.File(&quot;ALPS2017_DEF_VT.GRD&quot;,datarow=18,header=false,delim=&#39; &#39;);</code></pre><p>We can read the numerical data from the file with:</p><pre><code class="language-julia">julia&gt; data                    =   ParseColumns_CSV_File(data_file, 4);     
julia&gt; lon_Vz, lat_Vz, Vz_vec  =   data[:,1], data[:,2], data[:,3];</code></pre><h4 id=".-Check-and-reshape-vertical-velocity"><a class="docs-heading-anchor" href="#.-Check-and-reshape-vertical-velocity">2. Check &amp; reshape vertical velocity</a><a id=".-Check-and-reshape-vertical-velocity-1"></a><a class="docs-heading-anchor-permalink" href="#.-Check-and-reshape-vertical-velocity" title="Permalink"></a></h4><p>Let&#39;s have a look at the data, by plotting it:</p><pre><code class="language-julia">julia&gt; using Plots
julia&gt; Plots.scatter(lon_Vz,lat_Vz)</code></pre><p><img src="../../assets/img/Tutorial_GPS_1.png" alt="Tutorial_GPS_1"/></p><p>So clearly, this is a fully regular grid. We can determine the size of the grid with </p><pre><code class="language-julia">julia&gt; unique(lon_Vz)
41-element Vector{Float64}:
  4.0
  4.3
  4.6
  4.9
  5.2
  5.5
  5.8
  ⋮
 14.5
 14.8
 15.1
 15.4
 15.7
 16.0
julia&gt; unique(lat_Vz)
31-element Vector{Float64}:
 43.0
 43.2
 43.4
 43.6
 43.8
 44.0
 44.2
  ⋮
 48.0
 48.2
 48.4
 48.6
 48.8
 49.0</code></pre><p>So we have a <code>41</code> by <code>31</code> grid. GMG requires 3D matrixes for the data (as we want to plot the results in paraview in 3D). That is why we first initialize 3D matrixes for <code>lon,lat,Vz</code>:</p><pre><code class="language-julia">julia&gt; lon, lat, Vz            =   zeros(41,31,1),zeros(41,31,1),zeros(41,31,1)</code></pre><p>And we can reshape the vectors accordingly:</p><pre><code class="language-julia">julia&gt; lon[:,:,1]              =   reshape(lon_Vz,(41,31))
julia&gt; lat[:,:,1]              =   reshape(lat_Vz,(41,31))
julia&gt; Vz[:,:,1]               =   reshape(Vz_vec,(41,31))</code></pre><h4 id=".-Load-horizontal-velocities"><a class="docs-heading-anchor" href="#.-Load-horizontal-velocities">3. Load horizontal velocities</a><a id=".-Load-horizontal-velocities-1"></a><a class="docs-heading-anchor-permalink" href="#.-Load-horizontal-velocities" title="Permalink"></a></h4><p>Next, we load the horizontal velocities from the file <code>ALPS2017_DEF_HZ.GRD</code></p><pre><code class="language-julia">julia&gt; data_file                       =   CSV.File(&quot;ALPS2017_DEF_HZ.GRD&quot;,datarow=18,header=false,delim=&#39; &#39;);
julia&gt; data                            =   ParseColumns_CSV_File(data_file, 6);
julia&gt; lon_Hz, lat_Hz, Ve_Hz, Vn_Hz    =   data[:,1], data[:,2], data[:,3],  data[:,4];</code></pre><p>Let&#39;s plot the data as well:</p><pre><code class="language-julia">julia&gt; Plots.scatter(lon_Hz,lat_Hz)</code></pre><p><img src="../../assets/img/Tutorial_GPS_2.png" alt="Tutorial_GPS_2"/></p><p>So it appears that the horizontal velocities are given on the same regular grid as well, but not in the water.  This thus requires a bit more work. The strategy we take is to first define 2D matrixes with horizontal velocities with the same size as Vz which are initialized with <code>NaN</code> (not a number), which is treated specially by Paraview.</p><pre><code class="language-julia">julia&gt; Ve = ones(size(Vz))*NaN;
julia&gt; Vn = ones(size(Vz))*NaN;</code></pre><p>Next we loop over all points in <code>lon_Hz,lat_Hz</code> and place them into the 2D matrixes:</p><pre><code class="language-julia">julia&gt;  for i in eachindex(lon_Hz)
            ind = intersect(findall(x-&gt;x==lon_Hz[i], lon), findall(x-&gt;x==lat_Hz[i], lat))
            Ve[ind] .= Ve_Hz[i];
            Vn[ind] .= Vn_Hz[i];
        end</code></pre><p>At this stage, we have horizontal and vertical velocities in units of <code>m/yr</code>. Yet, given the small velocities in the Alps, it makes more sense to have them in units of <code>mm/yr</code>:</p><pre><code class="language-julia">julia&gt; Vz = Vz*1000;
julia&gt; Ve = Ve*1000;
julia&gt; Vn = Vn*1000;</code></pre><p>And the magnitude is:</p><pre><code class="language-julia">julia&gt; Vmagnitude  =   sqrt.(Ve.^2 + Vn.^2 + Vz.^2);  </code></pre><h4 id=".-Interpolate-topography-on-grid"><a class="docs-heading-anchor" href="#.-Interpolate-topography-on-grid">4. Interpolate topography on grid</a><a id=".-Interpolate-topography-on-grid-1"></a><a class="docs-heading-anchor-permalink" href="#.-Interpolate-topography-on-grid" title="Permalink"></a></h4><p>At this stage we have the 3D velocity components on a grid. Yet, we don&#39;t have information yet about the elevation of the stations (as the provided data set did not give this).  We could ignore that and set the elevation to zero, which would allow saving the data directly to paraview.</p><p>Yet, a better way is to load the topographic map of the area and interpolate the elevation to the velocity grid. We are using the <code>GMT.jl</code> to load the topographic data:</p><pre><code class="language-julia">julia&gt; using GMT
julia&gt; Elevation =   gmtread(&quot;@earth_relief_01m.grd&quot;, limits=[3,17,42,50]);</code></pre><p>Next, we use the <code>Interpolations.jl</code> package to interpolate the topography:</p><pre><code class="language-julia">julia&gt; using Interpolations
julia&gt; interpol = LinearInterpolation((Elevation.x[1:end-1], Elevation.y[1:end-1]), Elevation.z&#39;);    
julia&gt; height   = interpol.(lon,lat)/1e3;</code></pre><h4 id=".-Saving-and-plotting-in-Paraview"><a class="docs-heading-anchor" href="#.-Saving-and-plotting-in-Paraview">5. Saving and plotting in Paraview</a><a id=".-Saving-and-plotting-in-Paraview-1"></a><a class="docs-heading-anchor-permalink" href="#.-Saving-and-plotting-in-Paraview" title="Permalink"></a></h4><p>At this stage, we have all we need. As the velocity is a vector field, we need to save it as a data structure with 3 components. When saving to paraview, GMG internally does a vector transformation. As this transformation does not retain the <code>east/north</code> components of the velocity field, it is a good idea to save them as separate fields so we can color the vectors accordingly in Paraview. Also note that we do not attach units to the vector fields, but we do have them for the scalar fields:</p><pre><code class="language-julia">julia&gt; GPS_Sanchez_grid = GeoData(lon,lat,height,(Velocity_mm_year=(Ve,Vn,Vz),V_north=Vn*mm/yr, V_east=Ve*mm/yr, V_vertical=Vz*mm/yr, Vmagnitude = Vmagnitude*mm/yr, Topography = height*km))
GeoData 
  size  : (41, 31, 1)
  lon   ϵ [ 4.0 : 16.0]
  lat   ϵ [ 43.0 : 49.0]
  depth ϵ [ -2.6545 km : 3.426 km]
  fields: (:Velocity_mm_year, :V_north, :V_east, :V_vertical, :Vmagnitude, :Topography)</code></pre><p>Saving this to paraview is as always:</p><pre><code class="language-julia">julia&gt; Write_Paraview(GPS_Sanchez_grid, &quot;GPSAlps_Sanchez_2017_grid&quot;)</code></pre><p>Opening and plotting the vertical field gives: <img src="../../assets/img/Tutorial_GPS_3.png" alt="Tutorial_GPS_3"/></p><p>In order to plot the velocities as arrows, you need to select the <code>Glyph</code> tool (red circle). Also specify <code>Velocity_mm_year ()</code> as both Orientation and Scale Array, and add <code>50</code> as scale factor. Once you push <code>Apply</code> it should look like: <img src="../../assets/img/Tutorial_GPS_4.png" alt="Tutorial_GPS_4"/></p><p>The arrows can now be colored by the individual velocity components or its magnitude.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tutorial_ISC_data/">« ISC earthquake data</a><a class="docs-footer-nextpage" href="../installation/">Installation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Saturday 16 October 2021 20:09">Saturday 16 October 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
