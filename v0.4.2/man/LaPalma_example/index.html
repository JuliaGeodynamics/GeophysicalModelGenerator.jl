<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Generating LaMEM model · GeophysicalModelGenerator.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">GeophysicalModelGenerator.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorials/">Overview</a></li><li><a class="tocitem" href="../tutorial_load3DSeismicData/">3D seismic tomography from ASCII</a></li><li><a class="tocitem" href="../tutorial_loadregular3DSeismicData_netCDF/">3D seismic tomography from netCDF</a></li><li><a class="tocitem" href="../tutorial_MohoTopo/">Visualize Moho topography</a></li><li><a class="tocitem" href="../tutorial_GMT_Topography/">Create GMT-based topography</a></li><li><a class="tocitem" href="../tutorial_Coastlines/">Coastlines</a></li><li><a class="tocitem" href="../tutorial_Screenshot_To_Paraview/">Import screenshots</a></li><li><a class="tocitem" href="../tutorial_loadirregular3DSeismicData/">Interpolate irregular 3D seismic tomography</a></li><li><a class="tocitem" href="../tutorial_GMT_Topography_GeologicalMap/">ETOPO1 Topography and geological maps</a></li><li><a class="tocitem" href="../tutorial_ISC_data/">ISC earthquake data</a></li><li><a class="tocitem" href="../tutorial_GPS/">Plot GPS vectors</a></li><li><a class="tocitem" href="../tutorial_UTM/">Read UTM data</a></li><li><a class="tocitem" href="../Tutorial_Votemaps/">VoteMaps</a></li><li><a class="tocitem" href="../tutorial_local_Flegrei/">Kilometer-scale volcano</a></li><li class="is-active"><a class="tocitem" href>Generating LaMEM model</a><ul class="internal"><li><a class="tocitem" href="#Aim"><span>Aim</span></a></li><li><a class="tocitem" href="#.-Load-data"><span>1. Load data</span></a></li><li><a class="tocitem" href="#.-Convert-data"><span>2. Convert data</span></a></li><li><a class="tocitem" href="#.-Create-LaMEM-setup"><span>3. Create LaMEM setup</span></a></li></ul></li><li><a class="tocitem" href="../tutorial_time_Seismicity/">Create movies</a></li></ul></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../datastructures/">Data Structures</a></li><li><a class="tocitem" href="../dataimport/">Data Import</a></li><li><a class="tocitem" href="../projection/">Projection</a></li><li><a class="tocitem" href="../paraview_output/">Paraview output</a></li><li><a class="tocitem" href="../tools/">Tools</a></li><li><a class="tocitem" href="../visualise/">Visualisation</a></li><li><a class="tocitem" href="../gravity_code/">Gravity code</a></li><li><a class="tocitem" href="../lamem/">LaMEM</a></li></ul></li><li><a class="tocitem" href="../listfunctions/">List of functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Generating LaMEM model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Generating LaMEM model</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Create-a-3D-LaMEM-setup-for-La-Palma"><a class="docs-heading-anchor" href="#Create-a-3D-LaMEM-setup-for-La-Palma">Create a 3D LaMEM setup for La Palma</a><a id="Create-a-3D-LaMEM-setup-for-La-Palma-1"></a><a class="docs-heading-anchor-permalink" href="#Create-a-3D-LaMEM-setup-for-La-Palma" title="Permalink"></a></h1><h2 id="Aim"><a class="docs-heading-anchor" href="#Aim">Aim</a><a id="Aim-1"></a><a class="docs-heading-anchor-permalink" href="#Aim" title="Permalink"></a></h2><p>In this tutorial, your will learn how to use real data to create a geodynamic model setup with LaMEM. We will use the data of La Palma, which is a volcanic island that started erupting in mid september 2021. LaMEM is a cartesian geodynamic model, which implies that you will have to transfer the data from <code>GeoData</code> to <code>CartData</code>.</p><h2 id=".-Load-data"><a class="docs-heading-anchor" href="#.-Load-data">1. Load data</a><a id=".-Load-data-1"></a><a class="docs-heading-anchor-permalink" href="#.-Load-data" title="Permalink"></a></h2><p>We will use two types of data to create the model</p><ol><li>Topography</li><li>Earthquake locations</li></ol><p>We start with loading the required packages</p><pre><code class="language-julia">using GeophysicalModelGenerator, JLD2
using GMT</code></pre><p>In case you managed to install GMT on your machine, you can automatically download the topography with</p><pre><code class="language-julia">Topo = ImportTopo(lon = [-18.7, -17.1], lat=[28.0, 29.2], file=&quot;@earth_relief_03s.grd&quot;)</code></pre><pre><code class="language-none">GeoData 
  size  : (1921, 1441, 1)
  lon   ϵ [ 341.3 : 342.9]
  lat   ϵ [ 28.0 : 29.2]
  depth ϵ [ -4.38297802734375 km : 2.414 km]
  fields: (:Topography,)
</code></pre><p>In case you did not manage that, we have prepared a JLD2 file <a href="https://seafile.rlp.net/f/03286a46a9f040a69b0f/?dl=1">here</a>. Download it, and doublecheck that you are in the same directory as the data file with:</p><pre><code class="language-julia">pwd()</code></pre><pre><code class="language-none">&quot;/Users/kausb/.julia/dev/GeophysicalModelGenerator/docs/src/scripts&quot;</code></pre><p>Load the data:</p><pre><code class="language-julia">Topo=load(&quot;Topo_LaPalma.jld2&quot;,&quot;Topo&quot;)</code></pre><pre><code class="language-none">GeoData 
  size  : (1921, 1441, 1)
  lon   ϵ [ 341.3 : 342.9]
  lat   ϵ [ 28.0 : 29.2]
  depth ϵ [ -4.38297802734375 km : 2.414 km]
  fields: (:Topography,)
</code></pre><p>Next, lets load the seismicity. We have prepared a file with earthquake locations up to early November (from <a href="https://www.ign.es/web/ign/portal/vlc-catalogo">https://www.ign.es/web/ign/portal/vlc-catalogo</a>). Download that <a href="https://seafile.rlp.net/f/03286a46a9f040a69b0f/?dl=1">here</a></p><pre><code class="language-julia">data_all_EQ = load(&quot;EQ_Data.jld2&quot;,&quot;data_all_EQ&quot;)</code></pre><pre><code class="language-none">GeoData 
  size  : (6045,)
  lon   ϵ [ -18.0341 : -17.6671]
  lat   ϵ [ 28.3102 : 28.8144]
  depth ϵ [ NaN km : NaN km]
  fields: (:Magnitude, :TimeSinceJan1_2021)
</code></pre><p>Write the data to paraview with</p><pre><code class="language-julia">Write_Paraview(data_all_EQ,&quot;data_all_EQ&quot;,PointsData=true)
Write_Paraview(Topo,&quot;Topo&quot;)</code></pre><pre><code class="language-none">Saved file: data_all_EQ.vtu
Saved file: Topo.vts
</code></pre><p>As earthquakes are point-wise data, you have to specify this. <img src="../../assets/img/TopoEQs_LaPalma_GeoData.png" alt="LaPalma_EQTopo_GeoData"/> Note that this data is not in &quot;easy&quot; coordinates (see coordinate axis in the plot, where <code>z</code> is <em>not</em> pointing upwards).</p><h2 id=".-Convert-data"><a class="docs-heading-anchor" href="#.-Convert-data">2. Convert data</a><a id=".-Convert-data-1"></a><a class="docs-heading-anchor-permalink" href="#.-Convert-data" title="Permalink"></a></h2><p>In order to create model setups, it is helpful to first transfer the data to Cartesian. This requires us to first determine a <em>projection point</em>, that is fixed. Often, it is helpful to use the center of the topography for this. In the present example, we will center the model around La Palma itself:</p><pre><code class="language-julia">proj = ProjectionPoint(Lon=-17.84, Lat=28.56)</code></pre><pre><code class="language-none">ProjectionPoint(28.56, -17.84, 222158.69478000276, 3.1625327286383654e6, 28, true)</code></pre><p>Once this is done you can convert the topographic data to the cartesian reference frame</p><pre><code class="language-julia">EQ_cart   = Convert2CartData(data_all_EQ, proj);
Topo_cart = Convert2CartData(Topo, proj)</code></pre><pre><code class="language-none">CartData 
    size   : (1921, 1441, 1)
    x      ϵ [ -86.09445705828863 km : 73.67229892155609 km]
    y      ϵ [ -63.5531883197492 km : 73.28446155584604 km]
    z      ϵ [ -4.38297802734375 km : 2.414 km]
    fields : (:Topography,)
</code></pre><p>It is important to realize that the cartesian coordinates of the topographic grid is no longer strictly orthogonal after this conversion. You don&#39;t notice that in the current example, as the model domain is rather small. In other cases, however, this is quite substantial (e.g., India-Asia collision zone). LaMEM needs an orthogonal grid of topography, which we can create with:</p><pre><code class="language-julia">Topo_LaMEM = CartData(XYZGrid(-70:.2:70,-60:.2:70,0));
nothing #hide</code></pre><p>In a next step, the routine <code>ProjectCartData</code> projects a <code>GeoData</code> structure to a <code>CartData</code> struct</p><pre><code class="language-julia">Topo_LaMEM = ProjectCartData(Topo_LaMEM, Topo, proj)</code></pre><pre><code class="language-none">CartData 
    size   : (701, 651, 1)
    x      ϵ [ -70.0 km : 70.0 km]
    y      ϵ [ -60.0 km : 70.0 km]
    z      ϵ [ -4.29541702331831 km : 2.3840784607152257 km]
    fields : (:Topography,)
</code></pre><p>Let&#39;s have a look at the data:</p><pre><code class="language-julia">Write_Paraview(EQ_cart,&quot;EQ_cart&quot;,PointsData=true)
Write_Paraview(Topo_LaMEM,&quot;Topo_LaMEM&quot;)</code></pre><pre><code class="language-none">Saved file: EQ_cart.vtu
Saved file: Topo_LaMEM.vts
</code></pre><h2 id=".-Create-LaMEM-setup"><a class="docs-heading-anchor" href="#.-Create-LaMEM-setup">3. Create LaMEM setup</a><a id=".-Create-LaMEM-setup-1"></a><a class="docs-heading-anchor-permalink" href="#.-Create-LaMEM-setup" title="Permalink"></a></h2><p>In a next step, we need to read the LaMEM input file of the simulation. In particular, this will read the lateral dimensions of the grid and the number of control volumes (elements), you want to apply in every direction. The LaMEM input file can be downloaded <a href="../../scripts/LaPalma.dat">here</a>. Make sure you are in the same directory as the *.dat file &amp; execute the following command</p><pre><code class="language-julia">Grid    = ReadLaMEM_InputFile(&quot;LaPalma.dat&quot;)</code></pre><pre><code class="language-none">LaMEM Grid: 
  nel         : (64, 64, 32)
  marker/cell : (3, 3, 3)
  markers     : (192, 192, 192)
  x           ϵ [-50.0 : 50.0]
  y           ϵ [-40.0 : 40.0]
  z           ϵ [-80.0 : 15.0]
</code></pre><p>The <code>LaMEM_grid</code> structure contains the number of elements in every direction and the number of markers in every cell. It also contains <code>Grid.X</code>, <code>Grid.Y</code>, <code>Grid.Z</code>, which are the coordinates of each of the markers in the 3 directions.</p><p>In a next step we need to give each of these points a <code>Phase</code> number (which is an integer, that indicates the type of the rock that point has), as well as the temperature (in Celcius).</p><pre><code class="language-julia">Phases  = ones(Int32,size(Grid.X))*2;
Temp    = ones(Float64,size(Grid.X));
nothing #hide</code></pre><p>In this example we set the temperature based on the depth, assuming a constant geotherm. Depth is given in kilometers</p><pre><code class="language-julia">Geotherm =  30;
Temp     =  -Grid.Z.*Geotherm;
nothing #hide</code></pre><p>Since we are in La Palma, we assume that temperatures are not less than 20 degrees. Moreover, in the mantle, we have the mantle adiabat (1350 C)</p><pre><code class="language-julia">Temp[Temp.&lt;20]    .=  20;
Temp[Temp.&gt;1350]  .=  1350;
nothing #hide</code></pre><p>Because of lacking data, we have pretty much no idea where the Moho is in La Palma. Somewhat arbitrary, we assume it to be at 40 km depth, and set the rocks below that to &quot;mantle&quot;:</p><pre><code class="language-julia">ind = findall( Grid.Z .&lt; -40);
Phases[ind] .= 3;
nothing #hide</code></pre><p>Everything above the free surface is assumed to be &quot;air&quot;</p><pre><code class="language-julia">ind     =   AboveSurface(Grid, Topo_cart);
Phases[ind] .= 0;
nothing #hide</code></pre><p>And all &quot;air&quot; points that are below sea-level becomes &quot;water&quot;</p><pre><code class="language-julia">ind = findall( (Phases.==0) .&amp; (Grid.Z .&lt; 0));
Phases[ind] .= 1;
nothing #hide</code></pre><p>You can interpret the seismicity in different ways. If you assume that there are fully molten magma chambers, there should be no earthquakes within the magma chamber (as stresses are liklely to be very small). If, however, this is a partially molten mush, extraction of melt of that mush will change the fluid pressure and may thus release build-up stresses. We will assume the second option in our model setup.</p><p>Looking at the seismicity, there is a swarm at around 35 km depth</p><pre><code class="language-julia">AddSphere!(Phases,Temp,Grid, cen=(0,0,-35), radius=5, phase=ConstantPhase(5), T=ConstantTemp(1200));
nothing #hide</code></pre><p>A shallower one exists as well</p><pre><code class="language-julia">AddEllipsoid!(Phases,Temp,Grid, cen=(-1,0,-11), axes=(3,3,8), StrikeAngle=225, DipAngle=45, phase=ConstantPhase(5), T=ConstantTemp(1200));
nothing #hide</code></pre><p>And there might be a mid-crustal one</p><pre><code class="language-julia">AddEllipsoid!(Phases,Temp,Grid, cen=(-0,0,-23), axes=(8,8,2), StrikeAngle=0, DipAngle=0, phase=ConstantPhase(5), T=ConstantTemp(1200));
nothing #hide</code></pre><p>We can generate a 3D model setup, which must include the <code>Phases</code> and <code>Temp</code> arrays</p><pre><code class="language-julia">Model3D = CartData(Grid, (Phases=Phases,Temp=Temp))
Write_Paraview(Model3D,&quot;Model3D&quot;)</code></pre><pre><code class="language-none">Saved file: Model3D.vts
</code></pre><p>The model setup looks like this <img src="../../assets/img/LaMEM_ModelSetup_LaPalma.png" alt="LaMEM_ModelSetup_LaPalma"/></p><p>We can create a LaMEM marker file from the <code>Model3D</code> setup and the (cartesian) topography</p><pre><code class="language-julia">Save_LaMEMTopography(Topo_cart, &quot;Topography.txt&quot;)
Save_LaMEMMarkersParallel(Model3D)</code></pre><pre><code class="language-none">Written LaMEM topography file: Topography.txt
Writing LaMEM marker file -&gt; ./markers/mdb.00000000.dat
</code></pre><p>Next, you can use this to run the LaMEM model and visualize the model results in Paraview as well. If you are interested in doing this, have a look at the LaMEM <a href="https://bitbucket.org/bkaus/lamem/wiki/Home">wiki</a> pages.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tutorial_local_Flegrei/">« Kilometer-scale volcano</a><a class="docs-footer-nextpage" href="../tutorial_time_Seismicity/">Create movies »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 24 June 2022 12:30">Friday 24 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
