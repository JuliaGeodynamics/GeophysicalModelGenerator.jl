<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Kilometer-scale volcano · GeophysicalModelGenerator.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">GeophysicalModelGenerator.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorials/">Overview</a></li><li><a class="tocitem" href="../tutorial_load3DSeismicData/">3D seismic tomography from ASCII</a></li><li><a class="tocitem" href="../tutorial_loadregular3DSeismicData_netCDF/">3D seismic tomography from netCDF</a></li><li><a class="tocitem" href="../tutorial_MohoTopo/">Visualize Moho topography</a></li><li><a class="tocitem" href="../tutorial_GMT_Topography/">Create GMT-based topography</a></li><li><a class="tocitem" href="../tutorial_Coastlines/">Coastlines</a></li><li><a class="tocitem" href="../tutorial_Screenshot_To_Paraview/">Import screenshots</a></li><li><a class="tocitem" href="../tutorial_loadirregular3DSeismicData/">Interpolate irregular 3D seismic tomography</a></li><li><a class="tocitem" href="../tutorial_GMT_Topography_GeologicalMap/">ETOPO1 Topography and geological maps</a></li><li><a class="tocitem" href="../tutorial_ISC_data/">ISC earthquake data</a></li><li><a class="tocitem" href="../tutorial_GPS/">Plot GPS vectors</a></li><li><a class="tocitem" href="../tutorial_UTM/">Read UTM data</a></li><li><a class="tocitem" href="../Tutorial_Votemaps/">VoteMaps</a></li><li class="is-active"><a class="tocitem" href>Kilometer-scale volcano</a><ul class="internal"><li><a class="tocitem" href="#Goal"><span>Goal</span></a></li><li><a class="tocitem" href="#Steps"><span>Steps</span></a></li></ul></li><li><a class="tocitem" href="../LaPalma_example/">Generating LaMEM model</a></li><li><a class="tocitem" href="../tutorial_time_Seismicity/">Create movies</a></li></ul></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../datastructures/">Data Structures</a></li><li><a class="tocitem" href="../dataimport/">Data Import</a></li><li><a class="tocitem" href="../projection/">Projection</a></li><li><a class="tocitem" href="../paraview_output/">Paraview output</a></li><li><a class="tocitem" href="../tools/">Tools</a></li><li><a class="tocitem" href="../visualise/">Visualisation</a></li><li><a class="tocitem" href="../gravity_code/">Gravity code</a></li><li><a class="tocitem" href="../lamem/">LaMEM</a></li></ul></li><li><a class="tocitem" href="../listfunctions/">List of functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Kilometer-scale volcano</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Kilometer-scale volcano</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaGeodynamics/GeophysicalModelGenerator.jl/blob/master/docs/src/man/tutorial_local_Flegrei.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Km-scale-volcano-tutorial-using-cartesian-coordinates"><a class="docs-heading-anchor" href="#Km-scale-volcano-tutorial-using-cartesian-coordinates">Km-scale volcano tutorial using cartesian coordinates</a><a id="Km-scale-volcano-tutorial-using-cartesian-coordinates-1"></a><a class="docs-heading-anchor-permalink" href="#Km-scale-volcano-tutorial-using-cartesian-coordinates" title="Permalink"></a></h1><h2 id="Goal"><a class="docs-heading-anchor" href="#Goal">Goal</a><a id="Goal-1"></a><a class="docs-heading-anchor-permalink" href="#Goal" title="Permalink"></a></h2><p>This tutorial visualizes available 3D data at a local volcano (Campi Flegrei caldera, Italy) using cartesian coordinates. This is done, e.g., when we only have geomorphological data in cartesian coordinates. It includes geological and geophysical data in UTM format from the following papers:</p><ul><li><p>Two shape files containing coastline and faults:</p><ul><li>Vilardo, G., Ventura, G., Bellucci Sessa, E. and Terranova, C., 2013. Morphometry of the Campi Flegrei caldera (southern Italy). Journal of maps, 9(4), pp.635-640. doi:10.1080/17445647.2013.842508</li></ul></li><li><p>Earthquake data for two volcanic unrests, in 1983-84 and 2005-2016:</p><ul><li><p>De Siena, L., Chiodini, G., Vilardo, G., Del Pezzo, E., Castellano, M., Colombelli, S., Tisato, N. and Ventura, G., 2017. Source and dynamics of a volcanic caldera unrest: Campi Flegrei, 1983–84. Scientific reports, 7(1), pp.1-13. doi:10.1038/s41598-017-08192-7</p></li><li><p>De Siena, L., Sammarco, C., Cornwell, D.G., La Rocca, M., Bianco, F., Zaccarelli, L. and Nakahara, H., 2018. Ambient seismic noise image of the structurally controlled heat and fluid feeder pathway at Campi Flegrei caldera. Geophysical Research Letters, 45(13), pp.6428-6436. doi:10.1029/2018GL078817</p></li></ul></li><li><p>Travel time tomography model:</p><ul><li>Battaglia, Jean, Aldo Zollo, Jean Virieux, and Dario Dello Iacono, 2008. Merging active and passive data sets in traveltime tomography: the case study of Campi Flegrei caldera (Southern Italy). Geophysical Prospecting 56, no. 4: 555-573.  doi:10.1111/j.1365-2478.2007.00687.x</li></ul></li><li><p>Ambient noise tomography model:</p><ul><li>Battaglia, Jean, Aldo Zollo, Jean Virieux, and Dario Dello Iacono, 2008. Merging active and passive data sets in traveltime tomography: the case study of Campi Flegrei caldera (Southern Italy). Geophysical Prospecting 56, no. 4: 555-573.  doi:10.1111/j.1365-2478.2007.00687.x</li></ul></li></ul><h2 id="Steps"><a class="docs-heading-anchor" href="#Steps">Steps</a><a id="Steps-1"></a><a class="docs-heading-anchor-permalink" href="#Steps" title="Permalink"></a></h2><h4 id=".-Download-all-data-for-region"><a class="docs-heading-anchor" href="#.-Download-all-data-for-region">1. Download all data for region</a><a id=".-Download-all-data-for-region-1"></a><a class="docs-heading-anchor-permalink" href="#.-Download-all-data-for-region" title="Permalink"></a></h4><p>You will need to download the zipped folder containing all files from <a href="https://seafile.rlp.net/f/ff2c8424274c4d56b1f7/">here</a>.</p><p>Make sure that you are in the unzipped directory.</p><h4 id=".-Geomorphology"><a class="docs-heading-anchor" href="#.-Geomorphology">2. Geomorphology</a><a id=".-Geomorphology-1"></a><a class="docs-heading-anchor-permalink" href="#.-Geomorphology" title="Permalink"></a></h4><p>Load both the the shape (.shp) files contained in &quot;./Geomorphology/*.shp&quot; inside Paraview. In the following figures we show the Cartesian representation (not geolocalized - left) and the UTM (UTM). Our shape files can only be loaded in the cartesian:</p><p><img src="../../assets/img/Flegrei_Geomorphology.png" alt="Tutorial_Flegrei_Geomorphology"/></p><p>To reproduce it, represent the coastline as data points with black solid color and assign your favourite color map to the morphology. Note that each block color number corresponds to a different morphology. Beware that this file only works in cartesian coordinate, as it is still impossible to generate shape files in real UTM coordinates</p><h4 id=".-Earthquakes"><a class="docs-heading-anchor" href="#.-Earthquakes">3. Earthquakes</a><a id=".-Earthquakes-1"></a><a class="docs-heading-anchor-permalink" href="#.-Earthquakes" title="Permalink"></a></h4><p>Now let&#39;s plot earthquake data provided as text files. Start loading the data contained in &quot;./SeismicLocations/*.txt&quot;. The first column gives us a temporal marker we can use to plot earthquakes in different periods.</p><pre><code class="language-julia">julia&gt; using DelimitedFiles, GeophysicalModelGenerator, Glob, GeoStats
julia&gt; data_80s            = readdlm(&quot;SeismicLocations/Seismicity_UTM_1983_1984.txt&quot;, &#39;\t&#39;, skipstart=0, header=false);
julia&gt; data_00s            = readdlm(&quot;SeismicLocations/Seismicity_UTM_2005_2016.txt&quot;, &#39; &#39;, skipstart=0, header=false);
julia&gt; data                = vcat(data_80s,data_00s)        
julia&gt; time                = data[:,1];
julia&gt; WE                  = data[:,2];
julia&gt; SN                  = data[:,3];
julia&gt; depth               = data[:,4];
julia&gt; EQ_Data_Cart        = CartData(WE,SN,depth,(Depth=depth * m,Time=time * yr,));
julia&gt; Write_Paraview(EQ_Data_Cart, &quot;CF_Earthquakes_Cartesian&quot;, PointsData=true)
julia&gt; EQ_Data_UTM         = UTMData(WE, SN, depth, 33, true, (Depth=depth * m,Time=time * yr,));
julia&gt; Data_set_UTM        =   convert(GeophysicalModelGenerator.GeoData,EQ_Data_UTM)
julia&gt; Write_Paraview(Data_set_UTM, &quot;CF_Earthquakes_UTM&quot;, PointsData=true)</code></pre><p>Save in paraview with both cartesian and UTM formats. The final seismicity map looks like this:</p><p><img src="../../assets/img/Flegrei_Seismicity.png" alt="Tutorial_Flegrei_seismicity"/></p><p>The colour scale distinguishes earthquakes of different decades. Notice the progressive migration of recent seismicity (black dots) towards East.</p><h4 id=".-Velocity-model"><a class="docs-heading-anchor" href="#.-Velocity-model">4. Velocity model</a><a id=".-Velocity-model-1"></a><a class="docs-heading-anchor-permalink" href="#.-Velocity-model" title="Permalink"></a></h4><p>Using the Alps tutorial it is easy to create a paraview file from the Vp, Vs and Vp/Vs model in &quot;./TravelTmeTomography/modvPS.dat&quot; for both cartesian and UTM coordinates.</p><pre><code class="language-julia">julia&gt; using DelimitedFiles, GeophysicalModelGenerator
julia&gt; data            =   readdlm(&quot;TravelTimeTomography/modvPS.dat&quot;, &#39;\t&#39;, Float64, skipstart=0, header=false);
julia&gt; WE              =   data[:,1];
julia&gt; SN              =   data[:,2];
julia&gt; depth           =   data[:,3];
julia&gt; Vp              =   data[:,4];
julia&gt; Vs              =   data[:,5];
julia&gt; VpVs            =   data[:,6];
julia&gt; resolution      =   (length(unique(depth)),  length(unique(SN)), length(unique(WE)))
julia&gt; dim_perm        =   [3 2 1]
julia&gt; we              =   permutedims(reshape(WE, resolution), dim_perm);
julia&gt; sn              =   permutedims(reshape(SN, resolution), dim_perm);
julia&gt; depth           =   permutedims(reshape(depth, resolution), dim_perm);
julia&gt; Vp3d            =   permutedims(reshape(Vp, resolution), dim_perm);
julia&gt; Vs3d            =   permutedims(reshape(Vs, resolution), dim_perm);
julia&gt; Vp_Vs3d         =   permutedims(reshape(VpVs, resolution), dim_perm);
julia&gt; Data_set_Cartesian  =   CartData(we, sn, depth, (vp = Vp3d * (km / s), vs = Vs3d * (km / s), vpvs = Vp_Vs3d,))
julia&gt; Write_Paraview(Data_set_Cartesian, &quot;CF_Velocity_Cartesian&quot;)
julia&gt; Data_set        =   UTMData(we, sn, depth, 33, true, (vp = Vp3d * (km / s), vs = Vs3d * (km / s), vpvs = Vp_Vs3d,))
julia&gt; Data_set_UTM    =   convert(GeophysicalModelGenerator.GeoData,Data_set)
julia&gt; Write_Paraview(Data_set_UTM, &quot;CF_Velocity_UTM&quot;)</code></pre><p>Including the Vp/Vs model in the previous Paraview file workspace:</p><p><img src="../../assets/img/Flegrei_VpVs.png" alt="Tutorial_Flegrei_VpVs"/></p><h4 id=".-Horizontal-slices-of-shear-velocity-on-irregular-grid"><a class="docs-heading-anchor" href="#.-Horizontal-slices-of-shear-velocity-on-irregular-grid">5. Horizontal slices of shear velocity on irregular grid</a><a id=".-Horizontal-slices-of-shear-velocity-on-irregular-grid-1"></a><a class="docs-heading-anchor-permalink" href="#.-Horizontal-slices-of-shear-velocity-on-irregular-grid" title="Permalink"></a></h4><p>Using ambient noise you can map shear wave velocity at different depths. The models at each depth are contained in the files &quot;./NoiseTomography/*.txt&quot;. We read them consecutively in a &quot;for&quot; loop:</p><pre><code class="language-julia">julia&gt; list_files        = glob(&quot;AmbientNoiseTomography/*.txt&quot;);
julia&gt; li                = size(list_files, 1);
julia&gt; for i = 1:li
julia&gt;   nameFile        = list_files[i];
julia&gt;   name_vts        = name_vts[24:26];
julia&gt;   data            = readdlm(nameFile, &#39;\t&#39;, Float64);
julia&gt;   WE              = data[:,1];
julia&gt;   SN              = data[:,2];
julia&gt;   depth           = data[:,3];
julia&gt;   Vs              = data[:,4];</code></pre><p>However these models are too wide, so it is better to constrain them:</p><pre><code class="language-julia">julia&gt;   findall( (WE .&gt;= 419000) .&amp; (WE.&lt;=435000) .&amp; (SN.&gt;=4514000) .&amp; (SN.&lt;=4528000) );
julia&gt;   WE              = WE[ind];
julia&gt;   SN              = SN[ind];
julia&gt;   depth           = depth[ind];
julia&gt;   Vs              = Vs[ind];</code></pre><p>Also, nodes are irregular, hence we create a 3D regular UTM:</p><pre><code class="language-julia">julia&gt;  l                = length(WE);
julia&gt;  n_WE             = minimum(WE):100:maximum(WE);
julia&gt;  n_SN             = minimum(SN):100:maximum(SN);
julia&gt;  we, sn, Depth    = XYZGrid(n_WE, n_SN, depth[1]);
julia&gt;  Vs_3D            = zeros(size(Depth));
julia&gt;  Cgrid            = GeoStats.CartesianGrid((size(we, 1), size(we, 2)), (minimum(we), minimum(sn)), (we[2,2,1] - we[1,1,1], sn[2,2,1] - sn[1,1,1]))
julia&gt;  coord            = PointSet([WE[:]&#39;; SN[:]&#39;]);
julia&gt;  Geo              = georef((Vs = Vs[:],), coord);
julia&gt;  P                = EstimationProblem(Geo, Cgrid, :Vs);
julia&gt;  S                = IDW(:Vs =&gt; (;neighbors=2));
julia&gt;  sol              = solve(P, S);
julia&gt;  sol_Vs           = values(sol).Vs;
julia&gt;  Vs_2D            = reshape(sol_Vs, size(domain(sol)));
julia&gt;  Vs_3D[:,:,1]     = Vs_2D;
julia&gt;  Data_set_Cart    = CartData(we, sn, Depth, (Vs = Vs_3D  * (km / s),))
julia&gt;  Write_Paraview(Data_set_Cart, &quot;CF_Noise&quot; * name_vts * &quot;_Cartesian&quot;)
julia&gt;  Data_set         = UTMData(we, sn, Depth, 33, true, (Vs = Vs_3D*(km / s),));
julia&gt;  Data_set_UTM     = convert(GeophysicalModelGenerator.GeoData, Data_set);
julia&gt;  Write_Paraview(Data_set_UTM, &quot;CF_Noise_UTM_&quot;*name_vts)
julia&gt;  end</code></pre><p>This is one of the horizontal sections created by the code in the previous model in both reference systems:</p><p><img src="../../assets/img/Flegrei_Noise.png" alt="Tutorial_Flegrei_Noise"/></p><p>If you want to run the entire example, you can find the .jl code <a href="https://github.com/JuliaGeodynamics/GeophysicalModelGenerator.jl/blob/main/tutorial/Tutorial_Flegrei.jl">here</a></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Tutorial_Votemaps/">« VoteMaps</a><a class="docs-footer-nextpage" href="../LaPalma_example/">Generating LaMEM model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 24 June 2022 12:30">Friday 24 June 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
